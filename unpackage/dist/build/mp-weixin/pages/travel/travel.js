(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/travel/travel"],{"0ddd":function(t,e,n){"use strict";var o,a=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.HMmessages=t.$refs.HMmessages})},r=[];n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}))},"339e":function(t,e,n){"use strict";n.r(e);var o=n("56a3"),a=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=a.a},3448:function(t,e,n){"use strict";n.r(e);var o=n("0ddd"),a=n("339e");for(var r in a)"default"!==r&&function(t){n.d(e,t,(function(){return a[t]}))}(r);n("8f90");var i,c=n("f0c5"),s=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,"236efe39",null,!1,o["a"],i);e["default"]=s.exports},"4d61":function(t,e,n){"use strict";(function(t){n("144c"),n("921b");o(n("66fd"));var e=o(n("3448"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"56a3":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=c(n("4795")),a=n("2f62"),r=n("df07"),i=n("8af1");function c(t){return t&&t.__esModule?t:{default:t}}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n,o,a,r,i){try{var c=t[r](i),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(o,a)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var r=t.apply(e,n);function i(t){l(r,o,a,i,c,"next",t)}function c(t){l(r,o,a,i,c,"throw",t)}i(void 0)}))}}function h(t){return g(t)||v(t)||p(t)||m()}function m(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){if(t){if("string"===typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}function v(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}function g(t){if(Array.isArray(t))return b(t)}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var y=function(){n.e("components/HM-messages").then(function(){return resolve(n("c6d4"))}.bind(null,n)).catch(n.oe)},w=function(){Promise.all([n.e("common/vendor"),n.e("components/modal")]).then(function(){return resolve(n("0631"))}.bind(null,n)).catch(n.oe)},O=n("baa7"),P=wx.cloud.database(),j=P.collection("SQL-UserData"),x={name:"travel",created:function(){this.addRess();var t=this.address;this.$store.commit("travelmuta",t)},onShow:function(){var t=!1;this.$store.commit("refreshMuta",t)},components:{HMmessages:y,cpn_modal:w},data:function(){return{num:0,fication:[{name:"景点"},{name:"美食"},{name:"网红打卡"}],uploadShow:!1,chooseTab:"景点",titledata:"",tipsdata:"",topimg:[],videos:"",address:"",avatarUrl:"",nickName:"",openid:"",reldata:"正在发布...",relend:!1}},methods:{menubtn:function(t,e){this.num=t,this.chooseTab=e},uploadImg:function(){var e=this;t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(t){var n;(n=e.topimg).push.apply(n,h(t.tempFilePaths))}})},deleteImg:function(t){this.topimg.splice(t,1)},preImage:function(t){(0,r.previewImage)(t,this.topimg).then((function(t){})).catch((function(t){console.log("预览失败")}))},uploadVideo:function(){var e=this;t.chooseVideo({count:1,compressed:!1,sourceType:["album"],maxDuration:40}).then((function(t){e.videos=t[1].tempFilePath,e.uploadShow=!0})).catch((function(t){console.log(t)}))},deleteVideo:function(){this.videos="",this.uploadShow=!1},addRess:function(){var t=this;(0,i.addressData)().then((function(e){t.address=e.result.ad_info.city})).catch((function(e){t.address="桂林市"}))},chooseCity:function(){t.navigateTo({url:"../city/city"})},suBmitd:function(){""==this.titledata?this.HMmessages.show("标题必填",{icon:"error",iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(238,64,0,1)"}):""==this.tipsdata?this.HMmessages.show("描述必填",{icon:"error",iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(238,64,0,1)"}):this.UserInfo()},UserInfo:function(){var t=this,e=wx.cloud.database(),n=e.collection("SQL-User");n.get().then((function(e){if(0==e.data.length)t.$nextTick((function(){t.$refs.mon.modal_init()}));else{var n=e.data[0];t.avatarUrl=n.avatarUrl,t.nickName=n.nickName,t.openid=n.openid,t.relend=!0,t.uploadUserData()}})).catch((function(t){console.log(t)}))},uploadUserData:function(){var t=this;return d(o.default.mark((function e(){var n,a;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.upImage();case 2:return n=e.sent,e.next=5,t.upVideo();case 5:return a=e.sent,e.next=8,t.upLoadText(n,a);case 8:return e.next=10,t.refreshPage();case 10:case"end":return e.stop()}}),e)})))()},upImage:function(){var t=this,e=[],n=[];return console.log("开始上传图片"),new Promise((function(o,a){0==t.topimg.length?(console.log("用户不上传图片"),o("")):t.topimg.forEach((function(a){var r=a.lastIndexOf("."),i=a.slice(r),c="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(i);e.push("cloud://test-01-nkmqa.7465-test-01-nkmqa-1300405154/static/"+c),wx.cloud.uploadFile({cloudPath:"static/"+c,filePath:a}).then((function(a){n.push(a.fileID),n.length==t.topimg.length&&o(e),console.log("上传图片成功")})).catch((function(t){console.log(t)}))}))}))},upVideo:function(){var t=this;return console.log("开始上传视频"),new Promise((function(e,n){if(""==t.videos)console.log("用户不上传视频"),e("");else{var o=t.videos.lastIndexOf("."),a=t.videos.slice(o),r="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(a);wx.cloud.uploadFile({cloudPath:"video/"+r,filePath:t.videos}).then((function(t){e(t.fileID),console.log("上传视频成功")})).catch((function(t){console.log(t)}))}}))},upLoadText:function(e,n){var o=this;console.log("开始上传数据库");var a={chooseTab:this.chooseTab,titledata:this.titledata,tipsdata:this.tipsdata,topimg:e,videos:n,address:this.address,avatarUrl:this.avatarUrl,nickName:this.nickName,openid:this.openid,creatTime:O.formatTime(new Date)};j.add({data:a}).then((function(e){console.log("上传数据库成功"),o.reldata="发布成功!",setTimeout((function(){t.switchTab({url:"../strategy/strategy"})}),1700)})).catch((function(t){console.log(t)}))},refreshPage:function(){var t=!0;this.$store.commit("refreshMuta",t)}},computed:u({},(0,a.mapState)(["store_city_02"]),{valueChange_02:function(){this.address=this.store_city_02}})};e.default=x}).call(this,n("543d")["default"])},"8f90":function(t,e,n){"use strict";var o=n("bbdc"),a=n.n(o);a.a},bbdc:function(t,e,n){}},[["4d61","common/runtime","common/vendor"]]]);