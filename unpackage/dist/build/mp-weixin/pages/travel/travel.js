(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/travel/travel"],{"339e":function(t,e,n){"use strict";n.r(e);var o=n("56a3"),a=n.n(o);for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);e["default"]=a.a},3448:function(t,e,n){"use strict";n.r(e);var o=n("8b52"),a=n("339e");for(var r in a)"default"!==r&&function(t){n.d(e,t,(function(){return a[t]}))}(r);n("6764");var i,c=n("f0c5"),s=Object(c["a"])(a["default"],o["b"],o["c"],!1,null,"7def7074",null,!1,o["a"],i);e["default"]=s.exports},"38fc":function(t,e,n){},"4d61":function(t,e,n){"use strict";(function(t){n("144c"),n("921b");o(n("66fd"));var e=o(n("3448"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"56a3":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=c(n("a34a")),a=n("2f62"),r=n("df07"),i=n("8af1");function c(t){return t&&t.__esModule?t:{default:t}}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n,o,a,r,i){try{var c=t[r](i),s=c.value}catch(u){return void n(u)}c.done?e(s):Promise.resolve(s).then(o,a)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var r=t.apply(e,n);function i(t){l(r,o,a,i,c,"next",t)}function c(t){l(r,o,a,i,c,"throw",t)}i(void 0)}))}}function h(t){return v(t)||m(t)||p()}function p(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function m(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function v(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}var g=function(){n.e("components/HM-messages").then(function(){return resolve(n("c6d4"))}.bind(null,n)).catch(n.oe)},b=function(){Promise.all([n.e("common/vendor"),n.e("components/modal")]).then(function(){return resolve(n("0631"))}.bind(null,n)).catch(n.oe)},y=n("baa7"),w=wx.cloud.database(),O=w.collection("SQL-UserData"),P={name:"travel",created:function(){this.addRess();var t=this.address;this.$store.commit("travelmuta",t)},onShow:function(){var t=!1;this.$store.commit("refreshMuta",t)},components:{HMmessages:g,cpn_modal:b},data:function(){return{num:0,fication:[{name:"景点"},{name:"美食"},{name:"网红打卡"}],uploadShow:!1,chooseTab:"景点",titledata:"",tipsdata:"",topimg:[],videos:"",address:"",avatarUrl:"",nickName:"",openid:"",reldata:"正在发布...",relend:!1}},methods:{menubtn:function(t,e){this.num=t,this.chooseTab=e},uploadImg:function(){var e=this;t.chooseImage({count:9,sizeType:["original","compressed"],sourceType:["album"],success:function(t){var n;(n=e.topimg).push.apply(n,h(t.tempFilePaths))}})},deleteImg:function(t){this.topimg.splice(t,1)},preImage:function(t){(0,r.previewImage)(t,this.topimg).then((function(t){})).catch((function(t){console.log("预览失败")}))},uploadVideo:function(){var e=this;t.chooseVideo({count:1,compressed:!1,sourceType:["album"],maxDuration:40}).then((function(t){e.videos=t[1].tempFilePath,e.uploadShow=!0})).catch((function(t){console.log(t)}))},deleteVideo:function(){this.videos="",this.uploadShow=!1},addRess:function(){var t=this;(0,i.addressData)().then((function(e){t.address=e.result.ad_info.city})).catch((function(e){t.address="桂林市"}))},chooseCity:function(){t.navigateTo({url:"../city/city"})},suBmitd:function(){""==this.titledata?this.HMmessages.show("标题必填",{icon:"error",iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(238,64,0,1)"}):""==this.tipsdata?this.HMmessages.show("描述必填",{icon:"error",iconColor:"#ffffff",fontColor:"#ffffff",background:"rgba(238,64,0,1)"}):this.UserInfo()},UserInfo:function(){var t=this,e=wx.cloud.database(),n=e.collection("SQL-User");n.get().then((function(e){if(0==e.data.length)t.$nextTick((function(){t.$refs.mon.modal_init()}));else{var n=e.data[0];t.avatarUrl=n.avatarUrl,t.nickName=n.nickName,t.openid=n.openid,t.relend=!0,t.uploadUserData()}})).catch((function(t){console.log(t)}))},uploadUserData:function(){var t=d(o.default.mark((function t(){var e,n;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.upImage();case 2:return e=t.sent,t.next=5,this.upVideo();case 5:return n=t.sent,t.next=8,this.upLoadText(e,n);case 8:return t.next=10,this.refreshPage();case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),upImage:function(){var t=this,e=[],n=[];return new Promise((function(o,a){t.topimg.forEach((function(a){var r=a.lastIndexOf("."),i=a.slice(r),c="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(i);e.push("cloud://test-01-nkmqa.7465-test-01-nkmqa-1300405154/static/"+c),wx.cloud.uploadFile({cloudPath:"static/"+c,filePath:a}).then((function(a){n.push(a.fileID),n.length==t.topimg.length&&o(e)})).catch((function(t){console.log(t)}))}))}))},upVideo:function(){var t=this;return new Promise((function(e,n){if(""==t.videos)e("");else{var o=t.videos.lastIndexOf("."),a=t.videos.slice(o),r="".concat(Date.now(),"-").concat(Math.floor(1e7*Math.random(0,1))).concat(a);wx.cloud.uploadFile({cloudPath:"video/"+r,filePath:t.videos}).then((function(t){e(t.fileID)})).catch((function(t){console.log(t)}))}}))},upLoadText:function(e,n){var o=this,a={chooseTab:this.chooseTab,titledata:this.titledata,tipsdata:this.tipsdata,topimg:e,videos:n,address:this.address,avatarUrl:this.avatarUrl,nickName:this.nickName,openid:this.openid,creatTime:y.formatTime(new Date)};O.add({data:a}).then((function(e){o.reldata="发布成功!",setTimeout((function(){t.switchTab({url:"../strategy/strategy"})}),1700)})).catch((function(t){console.log(t)}))},refreshPage:function(){var t=!0;this.$store.commit("refreshMuta",t)}},computed:u({},(0,a.mapState)(["store_city_02"]),{valueChange_02:function(){this.address=this.store_city_02}})};e.default=P}).call(this,n("543d")["default"])},6764:function(t,e,n){"use strict";var o=n("38fc"),a=n.n(o);a.a},"8b52":function(t,e,n){"use strict";var o,a=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.HMmessages=t.$refs.HMmessages})},r=[];n.d(e,"b",(function(){return a})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return o}))}},[["4d61","common/runtime","common/vendor"]]]);